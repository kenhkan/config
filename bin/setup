#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ANSIBLE_PATH="$( cd "$DIR/../ansible/" && pwd )"


### Setup ###

# Ask for the administrator password upfront
sudo -v

# Install Xcode
xcode-select --install

echo "Press ENTER when Xcode has finished installing."
read XCODE_INSTALLED

# Get Homebrew
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

# Get Ansible
brew install ansible


### Install ###

# Play setup playbook
ansible-playbook $ANSIBLE_PATH/setup_local.yml -i $ANSIBLE_PATH/hosts


### Setup OS X ###

# Use fish as the default shell
chsh -s /usr/local/bin/fish

# Keep-alive: update existing `sudo` time stamp until finish
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

# Configure OS X. Most scripts addapted from
# https://github.com/mathiasbynens/dotfiles/blob/master/.osx
osx/app
osx/dock
osx/finder
osx/general
osx/git
osx/input
osx/mac
osx/neobundle
osx/no_itunes
osx/screen
osx/spotlight
osx/ssd
osx/ssh
osx/terminal
osx/webkit


echo ""
echo "***** MANUAL STEPS *****"
echo "- Run this to register the SSH key with GitHub: `pbcopy < ~/.ssh/id_rsa.pub`"
echo "- Install Backblaze by opening the Backblaze installer"
echo "- Install OSXFuse (with MacFuse support) and VeraCrypt in the etc directory"
echo "- Run BlockBlock (/opt/homebrew-cask/Caskroom/blockblock/x.x.x/BlockBlock.app)"
echo "- Configure input sources"
echo "- Turn on firewall"
echo "- Turn on FileVault"
echo "- Setup iCloud and internet accounts"
echo "- Restart and enjoy!"
